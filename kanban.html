<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ticketmaster App - Project Kanban</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 36px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 18px;
            opacity: 0.9;
        }

        .last-updated {
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            margin-top: 10px;
        }

        .kanban-board {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .column {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            min-height: 200px;
        }

        .column-header {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .column-header .count {
            font-size: 16px;
            font-weight: 600;
            background: #f0f0f0;
            padding: 4px 12px;
            border-radius: 20px;
        }

        .todo .column-header {
            border-color: #9e9e9e;
            color: #616161;
        }

        .in-progress .column-header {
            border-color: #2196F3;
            color: #1976D2;
        }

        .done .column-header {
            border-color: #4CAF50;
            color: #388E3C;
        }

        .card {
            background: white;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border-left: 4px solid;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .todo .card {
            border-left-color: #9e9e9e;
        }

        .in-progress .card {
            border-left-color: #2196F3;
        }

        .done .card {
            border-left-color: #4CAF50;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .card-description {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
            margin-bottom: 12px;
        }

        .card-files {
            font-size: 12px;
            color: #999;
            font-family: 'Courier New', monospace;
            margin-top: 8px;
        }

        .card-tag {
            display: inline-block;
            padding: 4px 10px;
            background: #f0f0f0;
            border-radius: 4px;
            font-size: 12px;
            margin-top: 8px;
            color: #666;
        }

        .stats {
            max-width: 1400px;
            margin: 0 auto 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .stat-number {
            font-size: 36px;
            font-weight: 700;
            color: #333;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #66BB6A);
            transition: width 0.5s ease;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 18px;
        }

        .error {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            color: #d32f2f;
            max-width: 600px;
            margin: 40px auto;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
            font-style: italic;
        }

        .auto-refresh {
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸŽ« Ticketmaster Event Discovery App</h1>
        <p>Project Implementation Progress</p>
        <div class="last-updated" id="lastUpdated">Loading...</div>
    </div>

    <div id="app">
        <div class="loading">Loading progress data...</div>
    </div>

    <div class="auto-refresh">
        âŸ³ Auto-refreshing every 15 seconds | Data from: .worktrees/initial-implementation/progress.json
    </div>

    <script>
        let refreshInterval;

        async function fetchProgress() {
            try {
                const response = await fetch('/api/progress');
                const data = await response.json();

                if (data.error) {
                    showError(data.error);
                    return;
                }

                renderKanban(data);
            } catch (error) {
                showError(`Failed to load progress data: ${error.message}`);
            }
        }

        function renderKanban(data) {
            const { stats, tasks, lastUpdated } = data;

            // Update last updated time
            const updateTime = new Date(lastUpdated).toLocaleString();
            document.getElementById('lastUpdated').textContent = `Last updated: ${updateTime}`;

            // Build the kanban HTML
            const html = `
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number">${stats.total}</div>
                        <div class="stat-label">Total Tasks</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${stats.completed}</div>
                        <div class="stat-label">Completed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${stats.inProgress}</div>
                        <div class="stat-label">In Progress</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${stats.todo}</div>
                        <div class="stat-label">To Do</div>
                    </div>
                    <div class="stat-card" style="grid-column: span 2;">
                        <div class="stat-number">${stats.progressPercent}%</div>
                        <div class="stat-label">Overall Progress</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${stats.progressPercent}%"></div>
                        </div>
                    </div>
                </div>

                <div class="kanban-board">
                    <div class="column todo">
                        <div class="column-header">
                            <span>ðŸ“‹ To Do</span>
                            <span class="count">${tasks.todo.length}</span>
                        </div>
                        ${renderTasks(tasks.todo)}
                    </div>

                    <div class="column in-progress">
                        <div class="column-header">
                            <span>ðŸš€ In Progress</span>
                            <span class="count">${tasks.inProgress.length}</span>
                        </div>
                        ${renderTasks(tasks.inProgress)}
                    </div>

                    <div class="column done">
                        <div class="column-header">
                            <span>âœ… Done</span>
                            <span class="count">${tasks.done.length}</span>
                        </div>
                        ${renderTasks(tasks.done)}
                    </div>
                </div>
            `;

            document.getElementById('app').innerHTML = html;
        }

        function renderTasks(tasks) {
            if (tasks.length === 0) {
                return '<div class="empty-state">No tasks in this column</div>';
            }

            return tasks.map(task => `
                <div class="card">
                    <div class="card-title">${escapeHtml(task.title)}</div>
                    <div class="card-description">${escapeHtml(task.description)}</div>
                    ${task.files ? `<div class="card-files">${escapeHtml(task.files)}</div>` : ''}
                    <div class="card-tag">${escapeHtml(task.category)}</div>
                    ${task.completed ? `<div class="card-files" style="margin-top: 8px;">âœ“ Completed: ${escapeHtml(task.completed)}</div>` : ''}
                </div>
            `).join('');
        }

        function showError(message) {
            document.getElementById('app').innerHTML = `
                <div class="error">
                    <strong>Error:</strong> ${escapeHtml(message)}
                    <br><br>
                    Make sure the server is running and .worktrees/initial-implementation/progress.json exists.
                </div>
            `;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Initial load
        fetchProgress();

        // Auto-refresh every 15 seconds
        refreshInterval = setInterval(fetchProgress, 15000);

        console.log('Kanban board loaded. Auto-refreshing every 15 seconds.');
        console.log('Data source: progress.json via /api/progress endpoint');
    </script>
</body>
</html>
